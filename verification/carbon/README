#Experiment 1: Adjoint sensitivity using ALLOW_PASSIVE_TRACER and tr1
############

# generate and compile code
cd bin
ln -s ../verification/carbon/code/.genmakerc .
ln -s ../verification/carbon/code/*.[Fh] .
../tools/genmake -makefile
cd ../adjoint
make adtaf
make adchange
cd ../bin
make

# run code
cd ../exe
ln -s ../verification/carbon/input/* .
./mitgcmuv >&! output.txt

# grep for grdchk output
grep 'ph-grd 3' output.txt

#Experiment 2: same as Exp. 1, but using ALLOW_PTRACERS and ptracers
############

# generate and compile code
cd bin
ln -s ../verification/carbon/code_ptracers/.genmakerc .
ln -s ../verification/carbon/code_ptracers/*.[Fh] .
../tools/genmake -makefile
cd ../adjoint
mv makefile makefile.orig
cp ../verification/carbon/code_ptracers/makefile.ptracers makefile
make adtaf
make adchange
mv makefile.orig makefile
cd ../bin
make

# run code
cd ../exe
ln -s ../verification/carbon/input_ptracers/* .
ln -s ../verification/carbon/input/*.bin .
./mitgcmuv >&! output.txt

# grep for grdchk output
grep 'ph-grd 3' output.txt

#Experiment 3: same as Exp. 2, but using ALLOW_TANGENTLINEAR_RUN
############

# generate and compile code
cd bin
ln -s ../verification/carbon/code_ptracers/.genmakerc .
ln -s ../verification/carbon/code_ptracers/CPP_OPTIONS.h.TLM CPP_OPTIONS.h
ln -s ../verification/carbon/code_ptracers/*.[Fh] .
../tools/genmake -makefile
cd ../adjoint
mv makefile makefile.orig
cp ../verification/carbon/code_ptracers/makefile.ptracers makefile
make adtaf
make adchange
mv makefile.orig makefile
cd ../bin
make

# run code
cd ../exe
ln -s ../verification/carbon/input_ptracers/* .
ln -s ../verification/carbon/input/*.bin .
./mitgcmuv >&! output.txt

# grep for grdchk output
grep 'ph-grd 3' output.txt

